---
author: "Equipo Edumer"
editor: visual
---

# Results

## Descriptive

```{r packages, echo=FALSE}
pacman::p_load(tidyverse,
               ggpubr, 
               lme4, 
               ordinal,
               sjPlot, 
               texreg,
               kableExtra,
               easystats)

options(scipen=999)
rm(list = ls())
```

```{r data, echo=FALSE}

load("input/data/data_index.RData")
load("input/data/deservingness.RData")
load("input/data/soc_effort.RData")
load("input/data/soc_talent.RData")
load("input/data/school_effort.RData")
load("input/data/school_talent.RData")
load("input/data/data_rec.RData")

```

```{r functions, echo=FALSE}

odds_fun <- function(modelos) {
   or <- texreg::extract(modelos)
   or@coef <- exp(or@coef)
   return(or)
}

miles <- function(x) {
  format(round(as.numeric(x),0), big.mark = ".")
}

decimales <- function(x) {
  format(round(as.numeric(x), 2), decimal.mark = ",")
}

# set theme


theme_set(theme_bw())

```

@fig-marketjustice illustrates the distribution of responses to the three items on market justice preferences (healthcare, pensions, and education), indicating that most respondents tend to disagree or strongly disagree with the idea that it is just for people with higher incomes to have access to better services in these areas. The strongest opposition is observed in the healthcare sector, as the majority of respondents (66.4%) are against the idea that higher-income individuals should have access to better healthcare services. Similarly, regarding the concept of justice related to access to better pensions based on income, the level of disagreement reaches 63.0%. This decreases significantly in the field of education, as the percentage of respondents who disagree or strongly disagree with those with higher incomes having access to better education decreases to 58.8%. Only a small proportion agree that access to healthcare should be conditional on income (23.6%), and a minority strongly agree (10%), as is the case with pensions. However, this increases in the case of education, being the area where there is a significant proportion of respondents who agree or strongly agree with access based on market justice (41.2%).

```{r echo=FALSE}
#| fig-cap: "Market justice preferences in health, pensions and education"
#| fig-asp: 0.6
#| label: fig-marketjustice


data_rec %>% 
  select(just_salud, just_pension, just_educ) %>% 
  sjPlot::plot_stackfrq(geom.size = 0.5,
                        expand.grid =TRUE,
                      geom.colors = "PuBu",
                      show.total = FALSE, 
                      legend.labels = c("Strongly disagree", "Disagree", "Agree", "Strongly agree"),
                      axis.labels = c("Health", "Pensions", "Education")) +
 # theme_light(base_size = 16) +
  theme(legend.position="bottom", text = element_text(size = 14),
        plot.caption = element_text(hjust = 1)) +
       labs(caption = paste0("Source: Authors calculation based on First Study of Civic Education 2017",
                             " (N = ",dim(data_rec)[1],")"))

```

Regarding the perception of meritocracy, @fig-meritocracy displays the frequency distribution of five items related to the dimensions of school and society. At the school level, there is a strong belief that both effort and talent are important for achieving good grades, with especially high agreement for effort. Specifically, while 78.6% agree or strongly agree on the importance of talent for obtaining good grades, this proportion rises to 96.8% for effort, indicating that respondents value effort more than talent in this context.

```{r echo=FALSE}
#| fig-cap: "Social and school meritocracy"
#| fig-asp: 0.8
#| label: fig-meritocracy


plot<-data_rec %>% 
  select(merito_soc, esfuerzo_soc, inteligencia_soc, esfuerzo_esc, inteligencia_esc) %>% 
  sjPlot::plot_stackfrq(geom.size = 0.5,
                        expand.grid =TRUE,
                      geom.colors = "PuBu",
                      show.total = FALSE, 
                      vjust=c(rep(c("center"),12), "bottom", "top", rep(c("center"), 6)),
                      legend.labels = c("Strongly disagree", "Disagree", "Agree", "Strongly agree"),
                      axis.labels = c("Deservingness", "Social effort", "Social talent", "School effort", "School talent")) +
  #theme_light(base_size = 16) +
  theme(legend.position="bottom", text = element_text(size = 14),
        plot.caption = element_text(hjust = 1))


plot + 
  annotate("text", x = 5.5, y = 0, label = "School meritocracy", size = 5, hjust = 0, vjust = 1) +
  annotate("text", x = 3.5, y = 0, label = "Social meritocracy", size = 5, hjust = 0, vjust = 1) +
       labs(caption = paste0("Source: Authors calculation based on First Study of Civic Education 2017",
                             " (N = ",dim(data_rec)[1],")"))
```

At the societal level, @fig-meritocracy shows that a majority of respondents agree or strongly agree that individuals are rewarded for their talents (63.7%) and efforts (62%). Nevertheless, a notable proportion perceives that both effort and talent are not adequately rewarded in society, with 38.1% and 36.3% respectively. The perception of whether people get what they deserve in society is more divided; while a slim majority (56.5% combining agree and strongly agree) agrees, a significant minority (43.6%) disagrees, indicating that this is the most contentious item among respondents. There is general agreement that people are rewarded for talent and effort in society, but the consensus is weaker compared to school meritocracy.

@fig-bivariate shows a series of graphs depicting the association between the variables of market justice preferences - in education, health, and pensions - and the variables of meritocratic perception at school (effort and talent) and in society (effort, talent, and deservingness) (see conceptual diagram in @fig-hypotheses). On the left, we observe the social meritocracy diagrams, while on the right the school meritocracy diagrams are shown. For the three variables of perception of meritocracy in society the relationship is clear, since the average of market justice preferences increases the more there is agreement that people are rewarded for their effort, merit, and talent. This relationship needs to be clarified in the case of the variables of perception of meritocracy at school. To the extent that there is more agreement that the perception of talent is essential for obtaining good grades, the average of market justice preferences increases, but this relationship is not as clear as with the variables of meritocracy in society. In addition, the graph does not show a clear trend in the relationship between the perception that effort is essential to obtain good grades and market justice preferences.

```{r echo=FALSE}
#| fig-cap: "Market justice preferences in education, health and pensions by social and school meritocracy"
#| fig-asp: 1.22
#| label: fig-bivariate

plot_soc_effort <- soc_effort %>% 
  mutate(justice = str_to_title(justice),
         justice = factor(justice, levels = c("Health", "Pensions", "Education"), labels = c("Health", "Pensions", "Education"))) %>% 
  arrange(esfuerzo_soc, justice) %>% 
  ggplot(aes(x = esfuerzo_soc, y = mean)) +
  geom_point(aes(color = justice, shape = justice), size = 2) +
  scale_y_continuous(labels = decimales, limits = c(1, 4)) +
  scale_x_continuous(limits = c(1, 4),
                     breaks = seq(1, 4, by = 1),
                     label = c("Strongly\n disagree", 
                               "Disagree", 
                               "Agree", 
                               "Strongly\n agree")) +
  scale_color_brewer(palette = "Paired") +
  labs(x = "Social effort",
       y = "Market justice preferences") +
  theme(legend.position = "none",
        text = element_text(size = 11))

plot_deservingness <- deservingness %>% 
   mutate(justice = str_to_title(justice),
         justice = factor(justice, levels = c("Health", "Pensions", "Education"), labels = c("Health", "Pensions", "Education"))) %>% 
  arrange(merito_soc, justice) %>% 
  ggplot(aes(x = merito_soc, y = mean)) +
  geom_point(aes(color = justice, shape = justice), size = 2) +
  scale_y_continuous(labels = decimales, limits = c(1, 4)) +
  scale_x_continuous(limits = c(1, 4),
                     breaks = seq(1, 4, by = 1),
                     label = c("Strongly\n disagree", 
                               "Disagree", 
                               "Agree", 
                               "Strongly\n agree")) +
  scale_color_brewer(palette = "Paired") +
  labs(x = "Deservingness",
       y = "Market justice preferences") +
  theme(legend.position = "none",
        text = element_text(size = 11))

plot_soc_talent <- soc_talent %>% 
   mutate(justice = str_to_title(justice),
         justice = factor(justice, levels = c("Health", "Pensions", "Education"), labels = c("Health", "Pensions", "Education"))) %>% 
  arrange(inteligencia_soc, justice) %>%  
  ggplot(aes(x = inteligencia_soc, y = mean)) +
  geom_point(aes(color = justice, shape = justice), size = 2) +
  scale_y_continuous(labels = decimales, limits = c(1, 4)) +
  scale_x_continuous(limits = c(1, 4),
                     breaks = seq(1, 4, by = 1),
                     label = c("Strongly\n disagree", 
                               "Disagree", 
                               "Agree", 
                               "Strongly\n agree")) +
  scale_color_brewer(palette = "Paired") +
  labs(x = "Social talent",
       y = "Market justice preferences") +
  theme(legend.position = "none",
        text = element_text(size = 11))

plot_school_effort <- school_effort %>% 
  mutate(justice = str_to_title(justice),
         justice = factor(justice, levels = c("Health", "Pensions", "Education"), labels = c("Health", "Pensions", "Education"))) %>% 
  arrange(esfuerzo_esc, justice) %>%  
  ggplot(aes(x = esfuerzo_esc, y = mean)) +
  geom_point(aes(color = justice, shape = justice), size = 2) +
  scale_y_continuous(labels = decimales, limits = c(1, 4)) +
  scale_x_continuous(limits = c(1, 4),
                     breaks = seq(1, 4, by = 1),
                     label = c("Strongly\n disagree", 
                               "Disagree", 
                               "Agree", 
                               "Strongly\n agree")) +
  scale_color_brewer(palette = "Paired") +
  labs(x = "School effort",
       y = "") +
  theme(legend.position = "none",
        text = element_text(size = 11))


plot_school_talent <- school_talent %>% 
  mutate(justice = str_to_title(justice),
         justice = factor(justice, levels = c("Health", "Pensions", "Education"), labels = c("Health", "Pensions", "Education"))) %>% 
  arrange(inteligencia_esc, justice) %>% 
  ggplot(aes(x = inteligencia_esc, y = mean)) +
  geom_point(aes(color = justice, shape = justice), size = 2) +
  scale_y_continuous(labels = decimales, limits = c(1, 4)) +
  scale_x_continuous(limits = c(1, 4),
                     breaks = seq(1, 4, by = 1),
                     label = c("Strongly\n disagree", 
                               "Disagree", 
                               "Agree", 
                               "Strongly\n agree")) +
  scale_color_brewer(palette = "Paired") +
  labs(x = "School talent",
       y = "",
       color = NULL,
       shape = NULL) +
  theme(text = element_text(size = 11))

leg <- get_legend(plot_school_talent)

plot_school_talent <- plot_school_talent + theme(legend.position = "none")

ggarrange(plot_soc_effort, plot_school_effort, plot_soc_talent,
          plot_school_talent, plot_deservingness, leg, ncol = 2, nrow = 3) +
  labs(caption = paste0("Source: Authors calculation based on First Study of Civic Education 2017",
                             " (N = ",dim(data_rec)[1],")"))
```

## Multivariate

This section presents the results of the multilevel models. We begin by showing the results of the cumulative link mixed models in @tbl-ordinal-reg for the ordinal dependent variables of justice in health, pensions, and education separately, to determine if the effect of the predictors differs across these items. Then, we present the results of the linear mixed-effects models for the average index of preference for market justice in @tbl-lineal-reg[^1]. For the health item, the intraclass correlation (ICC) obtained for the null model (not shown) indicates that 5% of the total variance of this item is associated with specific characteristics of the schools, while it is 3% for the pensions item and 4% for the education item (ICC based on [@hox_multilevel_2010, p.15]). For the average index of market justice preferences, the ICC reaches 4%, indicating that overall, only a small percentage of the total variance in students’ market justice preferences is associated with school characteristics, thus limiting the possibility of finding effects at this second level of analysis. 

[^1]: The tables shows the effects of individual and contextual-level independent variables related to our hypothesis; however, the models also incorporate the control variables utilized in the study for each of the three dependent variables separately and for the average index (complete models are available in the [Appendix](#appendix)).

```{r echo=FALSE, include=FALSE}

data_pension <- data_rec %>% 
    dplyr::select(-just_educ, -just_salud, -redistribucion)
data_pension <- na.omit(data_pension)
data_pension$just_pension_fact <- as_factor(data_pension$just_pension)

m0_p <- clmm(just_pension_fact ~ 1 + (1 | mrbd), data=data_pension)

performance::icc(m0_p, by_group = T) 

m1_p <- clmm(just_pension_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + (1 | mrbd), data=data_pension) 

m2_p <- clmm(just_pension_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + educacion_rec + 
    libros_rec + acc_tec + internet_rec + (1 | mrbd), data=data_pension) 

m3_p <- clmm(just_pension_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + educacion_rec + 
    libros_rec + acc_tec + internet_rec + mean_educ + cod_depe2 + 
    cod_grupo + simce + (1 | mrbd), data=data_pension) 

modelos_pension <- list(m1_p, m2_p, m3_p)

# modelos_odd_pension <- map(tbls, odds_fun)

data_salud <- data_rec %>% 
    dplyr::select(-just_pension, -just_educ, -redistribucion)
data_salud <- na.omit(data_salud)
data_salud$just_salud_fact <- as_factor(data_salud$just_salud)

m0_h <- clmm(just_salud_fact ~ 1 + (1 | mrbd), data=data_salud)

performance::icc(m0_h, by_group = T) 

m1_h <- clmm(just_salud_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + (1 | mrbd), data=data_salud) 

m2_h <- clmm(just_salud_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + educacion_rec + 
    libros_rec + acc_tec + internet_rec + (1 | mrbd), data=data_salud) 

m3_h <- clmm(just_salud_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + educacion_rec + 
    libros_rec + acc_tec + internet_rec + mean_educ + cod_depe2 + 
    cod_grupo + simce + (1 | mrbd), data=data_salud) 

modelos_health <- list(m1_h, m2_h, m3_h)

# modelos_odd_health <- map(tbls, odds_fun)


data_educ <- data_rec %>% 
    dplyr::select(-just_pension, -just_salud, -redistribucion)
data_educ <- na.omit(data_educ)
data_educ$just_educ_fact <- as_factor(data_educ$just_educ)

m0_e <- clmm(just_educ_fact ~ 1 + (1 | mrbd), data=data_educ)

performance::icc(m0_e, by_group = T) 

m1_e <- clmm(just_educ_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + (1 | mrbd), data=data_educ) 

m2_e <- clmm(just_educ_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + educacion_rec + 
    libros_rec + acc_tec + internet_rec + (1 | mrbd), data=data_educ) 

m3_e <- clmm(just_educ_fact ~ 1 + inteligencia_esc + esfuerzo_esc + 
    inteligencia_soc + esfuerzo_soc + merito_soc + educacion_rec + 
    libros_rec + acc_tec + internet_rec + mean_educ + cod_depe2 + 
    cod_grupo + simce + (1 | mrbd), data=data_educ) 

modelos_educ <- list(m1_e, m2_e, m3_e)

#modelos_odd_educ <- map(tbls, odds_fun)

```

```{r echo=FALSE, results='asis'}
#| tbl-cap: "Cumulative link multilevel models of differential acces justificacion of health, pensions, and education"
#| label: tbl-ordinal-reg

ccoef <- list(
  inteligencia_esc = "School talent",
  esfuerzo_esc = "School effort",
  inteligencia_soc = "Social talent",
  esfuerzo_soc = "Social effort",
  merito_soc = "Deservingness",
  "educacion_recEd Media" = "Secondary",
  "educacion_recEd Tecnica" = "Higher tec.",
  "educacion_recUniversidad o posgrado" = "University or posgraduate",
  "educacion_recNs/Nr" = "Missing",
  "libros_recMás de 25" = "More than 25 books (Ref.= Less than 25)",
  "cod_grupoMedio bajo" = "SES Medium low",
  cod_grupoMedio = "SES Medium",
  "cod_grupoMedio alto" = "SES Medium high",
  cod_grupoAlto = "SES High",
  simceMedio = "Simce Medium",
  simceAlto = "Simce High"
)

texreg::htmlreg(l = list(modelos_health[[2]],
                         modelos_health[[3]],
                         modelos_pension[[2]],
                         modelos_pension[[3]],
                         modelos_educ[[2]],
                         modelos_educ[[3]]),   
                caption = NULL,
                stars = c(0.05, 0.01, 0.001),
                custom.note = "Note: Cells contain regression coefficients with standard errors in parentheses. Control variables are included. %stars",
                custom.header = list("Health" = 1:2, "Pensions" = 3:4, "Education" = 5:6),
                custom.model.names = rep(c("Model 1", "Model 2"), 3),
                custom.coef.map = ccoef,
                leading.zero = T,
                scalebox = 0.60,
                groups = list("Parental education (Ref.= 8th grade or less)" = 6:9,
                                "Socioeconomic level (Ref.= Low)" = 11:14,
                                "Achievement score (Ref.= Low)" = 15:16),
                custom.gof.rows = list("Controls"=rep("Yes",6)),
                include.loglik = FALSE, include.aic = FALSE)

```



Model 1 in @tbl-ordinal-reg for the three dependent variables of justice in differential access to health, pensions, and education demonstrates a similar trend regarding the effect of the perception of meritocracy on these items, with all effects being statistically significant (*p* < 0.05). Regarding the variables of social meritocracy, the three variables—talent, effort, and deservingness—show that as these increase, the justification for differentiated access to pensions, education, and health also increases. In the context of school meritocracy, the effects are mixed: as perceived school talent increases, the justification for differentiated access to these services increases; conversely, as perceived school effort increases, the justification decreases, holding all other variables constant.

Additionally, Model 1 shows the effect of family status, measured through the highest educational level of the parents and the number of books at home. For the three items—health, pensions, and education—a negative but statistically non-significant association with parents' educational level is observed. However, the results suggest a negative and statistically significant effect of the number of books at home for market justice in health and pensions, indicating that those with more than 25 books at home tend to justify less differentiated access in these areas compared to those with fewer than 25 books, controlling for other variables. This association is not observed for market justice in education.

Model 2 in @tbl-ordinal-reg incorporates school-level variables for the three items of market justice in health, pensions, and education. Regarding the socioeconomic level of the schools, the results show that high socioeconomic status schools maintain greater preferences for market justice in education compared to low socioeconomic status schools, with a statistically significant association (*p* < 0.05). This effect is not observed for the health and pensions variables. Moreover, the academic performance of schools shows negative and statistically significant effects for the three items of market justice separately. The findings suggest that schools with higher academic performance tend to justify market allocation principles less for access to health, pensions, and education compared to low-performing schools. This difference is also observed in schools with medium performance, but only for the domains of health and pensions.





```{r echo=FALSE, include=FALSE}

reg0_bienestar <- lmer(bienestar ~ 1 + (1 | mrbd), data = data_bienestar)

performance::icc(reg0_bienestar, by_group = T) 

reg1_bienestar <- lmer(bienestar ~ 1 + inteligencia_esc + esfuerzo_esc + 
                         inteligencia_soc + esfuerzo_soc + merito_soc + 
                         acc_tec + internet_rec +
                         (1 | mrbd), data=data_bienestar)

reg2_bienestar <- lmer(bienestar ~ 1 + inteligencia_esc + esfuerzo_esc + 
                         inteligencia_soc + esfuerzo_soc + merito_soc + 
                         educacion_rec + libros_rec + acc_tec + internet_rec +
                         (1 | mrbd), data=data_bienestar)

reg3_bienestar <- lmer(bienestar ~ 1 + mean_educ + cod_depe2 + cod_grupo +
                         simce + (1 | mrbd), data=data_bienestar)

reg4_bienestar <- lmer(bienestar ~ 1 + esfuerzo_soc + merito_soc + 
                         inteligencia_soc + esfuerzo_esc + inteligencia_esc + 
                         educacion_rec + libros_rec + acc_tec + internet_rec + 
                         mean_educ + cod_depe2 + cod_grupo + 
                         (1 | mrbd), data=data_bienestar)

reg5_bienestar <- lmer(bienestar ~ 1 + esfuerzo_soc + merito_soc + 
                         inteligencia_soc + esfuerzo_esc + inteligencia_esc + 
                         educacion_rec + libros_rec + acc_tec + internet_rec + 
                         mean_educ + cod_depe2 + cod_grupo + simce + 
                         (1 | mrbd), data=data_bienestar)


test01 <- anova(reg0_bienestar, reg1_bienestar, test = "Chisq")
test02 <- anova(reg0_bienestar, reg2_bienestar, test = "Chisq")
test03 <- anova(reg0_bienestar, reg3_bienestar, test = "Chisq")
test04 <- anova(reg0_bienestar, reg4_bienestar, test = "Chisq")
test05 <- anova(reg0_bienestar, reg5_bienestar, test = "Chisq")


test.pvalues1 <- test01$`Pr(>Chisq)`[2]
test.pvalues2 <- test02$`Pr(>Chisq)`[2]
test.pvalues3 <- test03$`Pr(>Chisq)`[2]
test.pvalues4 <- test04$`Pr(>Chisq)`[2]
test.pvalues5 <- test05$`Pr(>Chisq)`[2]

deviance1 <- test01$deviance[2]
deviance2 <- test02$deviance[2]
deviance3 <- test03$deviance[2]
deviance4 <- test04$deviance[2]
deviance5 <- test05$deviance[2]
```

```{r echo=FALSE, results='asis'}
#| tbl-cap: "Linear mixed-effects models for meritocracy perception and market justice preferences"
#| label: tbl-lineal-reg


ccoef <- list(
  "(Intercept)" = "Constant",
  inteligencia_esc = "School talent",
  esfuerzo_esc = "School effort",
  inteligencia_soc = "Social talent",
  esfuerzo_soc = "Social effort",
  merito_soc = "Deservingness",
  "educacion_recEd Media" = "Secondary",
  "educacion_recEd Tecnica" = "Higher tec.",
  "educacion_recUniversidad o posgrado" = "University or posgraduate",
  "educacion_recNs/Nr" = "Missing",
  "libros_recMás de 25" = "More than 25 books (Ref.= Less than 25)",
  "cod_grupoMedio bajo" = "SES Medium low",
  cod_grupoMedio = "SES Medium",
  "cod_grupoMedio alto" = "SES Medium high",
  cod_grupoAlto = "SES High",
  simceMedio = "Simce Medium",
  simceAlto = "Simce High"
)


texreg::htmlreg(list(reg1_bienestar, reg2_bienestar, reg4_bienestar, reg5_bienestar),
                custom.model.names = c("Model 1",
                                       "Model 2",
                                       "Model 3",
                                       "Model 4"),
                caption = NULL,
                stars = c(0.05, 0.01, 0.001),
                custom.note = "Note: Cells contain regression coefficients with standard errors in parentheses. Control variables are included. %stars",
                custom.coef.map = ccoef,
                leading.zero = T,
                scalebox = 0.60,
                groups = list("Parental education (Ref.= 8th grade or less)" = 7:10,
                              "Socioeconomic level (Ref.= Low)" = 12:15,
                              "Achievement score (Ref.= Low)" = 16:17),
                custom.gof.rows = list("Controls"=rep("Yes",4),
                                       "Deviance" = c(deviance1,
                                                    deviance2,
                                                    deviance4,
                                                    deviance5),
                                       "Deviance Test (p)" = c(test.pvalues1,
                                                             test.pvalues2,
                                                             test.pvalues4,
                                                             test.pvalues5)),
                include.loglik = FALSE,include.aic = FALSE)

```

Regarding our measure of market justice preferences index, the results of the multilevel linear estimation are shown in @tbl-individual-reg. The intraclass correlation obtained for the null model (not shown) it's equal to 4% (ICC based on [@hox_multilevel_2010, p.15]), which indicates that only a small percentage of the total variance of the students' market justice preferences are associated with the characteristics of schools, and therefore limits the possibilities of finding effects at this second level of analysis.

Model 1 introduces social meritocratic variables: effort (whether efforts are rewarded), deservingness (people get what they deserve), and social talent (intelligence and skills are rewarded in society). In line with our hypotheses, the perception of a meritocratic society is positively related to the justification of inequality. Model 2 shows a mixed picture: while those perceiving that talent is rewarded also justify the inequality, the perception that effort is rewarded at school is negatively related to justification of inequality. Family background variables in Model 3 reveal that education and technology access are not related to justification of inequality, whereby we observe a negative impact of family cultural capital as measured by the number of books at home. While school socio-structural variables added in Model 4 show no significant effects, average achievement scores in the SIMCE test depict a negative relationship with the dependent variable, meaning that students that attend schools with better achievement scores on average justify less inequality.

In relation to model fit, when comparing the deviance with a model without predictors (null model), all the models have a statistically significant difference, with model 5 having the lowest deviance. According to Raudenbush and Bryk's (2002) estimate of R2, the level 1 variance of model 5 is 0.11 and the level 2 variance is 0.72. The total variance of model 5 according to Snijders and Bosker (2012) is 0.14.

```{r echo=FALSE}
#| tbl-cap: "Interactions effects"
#| label: tbl-interact

pacman::p_load(kableExtra)
load("input/data/interact.RData")
kbl(collapse_rows,
    align = "lccccc", booktabs = T,
    col.names =  c("Variable", 
                   "School talent", 
                   "School effort",
                   "Social talent",
                   "Social effort", 
                   "Deservingness")) %>%
  add_header_above(c(" " = 1,
                     "Market Justice Preferences"=5), 
                   bold = T)%>%  
  kable_styling(latex_options = c("scale_down","HOLD_position"),
                full_width = F) %>%
  column_spec(1, bold = T, width = "4cm") %>%
  column_spec(column = 2:6,width = "1.5cm") %>%
  collapse_rows(columns = 1:2, valign = "middle") %>% 
  footnote(general = "***p < 0.001, **p < 0.01, *p < 0.05",
           footnote_as_chunk = T,general_title = "Note: ")

```

The interaction terms in @tbl-interact suggest that students' family background moderates the relationship between their meritocratic perceptions in Chile and their justification of inequality. The direction of these effects confirms our initial prediction. Thus, in line with our Hypothesis 3, the relationship between social effort and justification of inequality becomes less positive for those students whose parents achieved university or postgraduate education. That is, lower-status students (measured by parental education) justify more inequality when they adhere more strongly to deservingnessmeritocratic perceptions in Chile. This result confirms the enlightenment thesis (see above). The same moderating effect is observed for students' family cultural capital: the relationship between effort (but not deservingness nor social talent) and justification of inequality becomes less positive for students with more than 25 books at home. Interestingly, family cultural capital also moderates the relationship between meritocratic beliefs at school (as measured by students' belief that effort is important to get good grades) and justification of inequality.

At the school level, we also observe moderating effects of school status and students' meritocratic beliefs over their justification of inequality. Thus, in line with our Hypothesis 5, high-status schools justify less inequality when, on average, their students have a greater perception of meritocracy in Chile, as measured by the three indicators we used (i.e., effort, deservingness, and talent). Finally, as we stated in Hypothesis 7, low-achieving schools justify more inequality when their students have, on average, stronger meritocratic beliefs in Chile. In @fig-interaction we depict this moderating effect of school achievement for the relationship between deservingness and justification of inequality. We did not observe these moderating effects at the school level for students' meritocratic beliefs in the school (i.e., the idea that effort or talent are important to get good grades).

```{r echo=FALSE, include=FALSE}
load("input/data/data_rec.RData")
data_rec <- data_rec %>% rowwise() %>%  mutate(educacion_rec2 = case_when(educacion_rec=="Ed Basica"~"Low level",
                                                 educacion_rec=="Ed Media"~"Low level",
                                                 educacion_rec=="Ed Tecnica"~"Low level",
                                                 educacion_rec=="Universidad o posgrado"~"University or Postgraduate",
                                                 educacion_rec=="Ns/Nr"~"Missing"
                                                 ))
data_rec$educacion_rec2 <- factor(data_rec$educacion_rec2, levels = c("Low level", "University or Postgraduate", "Missing"))


data_rec <- data_rec %>% rowwise() %>%  mutate(cod_grupo2  = case_when(cod_grupo=="Bajo"~"Bajo",
                                                                       cod_grupo=="Medio bajo"~"Bajo",
                                                                       cod_grupo=="Medio"~"Bajo",
                                                                       cod_grupo=="Medio alto"~"Alto",
                                                                       cod_grupo=="Alto"~"Alto"))
data_rec$cod_grupo2 <- factor(data_rec$cod_grupo2, levels = c("Bajo", "Alto"))
data_rec$simce <- factor(data_rec$simce, labels = c("Low", "Medium", "High"))


data_bienestar <- na.omit(data_rec)
#data_bienestar <- data_bienestar %>% mutate(pension_rec = 5-just_pension,
#                                            educ_rec = 5-just_educ,
#                                            salud_rec = 5-just_salud)
data_bienestar <- data_bienestar %>% rowwise() %>% dplyr::mutate(bienestar = mean(c(just_educ, just_salud, just_pension), na.omit=TRUE))
data_bienestar$bienestar <- round(data_bienestar$bienestar, 2)

reg26.2_bienestar <- lmer(bienestar ~ 1 + esfuerzo_soc + inteligencia_soc + esfuerzo_esc + inteligencia_esc + educacion_rec2 + libros_rec + acc_tec + mean_educ + cod_depe2 + cod_grupo2 + merito_soc*simce + internet_rec + (1 + simce | mrbd), data=data_bienestar)

plot_interact<- plot_model(reg26.2_bienestar, type = "int", mdrt.values="minmax", title = "", colors = c("red", "white", "blue")) +
  ylim(1,4)+
  labs(x = "Deservingness", y="Market Justice Preferences", colour = "School Simce")+
  theme_bw()
```

```{r echo=FALSE, warning=FALSE}
#| fig-cap: "Interaction between deservingness and justification of inequality by school SIMCE achievement"
#| label: fig-interaction

plot_interact

```
